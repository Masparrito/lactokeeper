(function(){"use strict";const p=(t,i)=>{const e={initialCabras:t.initialCabras??0,initialLevanteTardio:t.initialLevanteTardio??0,initialLevanteMedio:t.initialLevanteMedio??0,initialLevanteTemprano:t.initialLevanteTemprano??0,initialCriaH:t.initialCriaH??0,initialCriaM:t.initialCriaM??0,initialPadres:t.initialPadres??1,comprasVientresAnual:t.comprasVientresAnual??0,mesInicioMonta1:t.mesInicioMonta1,mesInicioMonta2:t.mesInicioMonta2,mesInicioMonta3:t.mesInicioMonta3,mesInicioMonta4:t.mesInicioMonta4,duracionMontaDias:t.duracionMontaDias??45,diasGestacion:t.diasGestacion??150,litrosPromedioPorAnimal:t.litrosPromedioPorAnimal??1.8,diasLactanciaObjetivo:t.diasLactanciaObjetivo??305,litrosPicoPorAnimal:t.litrosPicoPorAnimal??((t.diasLactanciaObjetivo??305)>=305?(t.litrosPromedioPorAnimal??1.8)*1.4:(t.litrosPromedioPorAnimal??1.8)*1.5),porcentajePrenez:t.porcentajePrenez??85,porcentajeProlificidad:t.porcentajeProlificidad??120,mortalidadCrias:t.mortalidadCrias??5,mortalidadLevante:t.mortalidadLevante??3,mortalidadCabras:t.mortalidadCabras??3,tasaReemplazo:t.tasaReemplazo??20,eliminacionCabritos:t.eliminacionCabritos??100,precioLecheLitro:t.precioLecheLitro??.5,precioVentaCabritoKg:t.precioVentaCabritoKg??3,precioVentaDescarteAdulto:t.precioVentaDescarteAdulto??50,monedaSimbolo:t.monedaSimbolo??"$",matingDistribution:t.matingDistribution},l=[],m=i*12,u=30.44;let s=[],r=[],M=[],L=0;const P=Math.round(e.diasGestacion/u),f=6,T=e.mortalidadCrias/100/12,d=e.mortalidadLevante/100/12,z=e.mortalidadCabras/100/12,H=e.tasaReemplazo/100/12,k=e.comprasVientresAnual/12,h=new Set,g=[t.mesInicioMonta1,t.mesInicioMonta2,t.mesInicioMonta3,t.mesInicioMonta4].filter(o=>typeof o=="number"&&o>0);g.forEach(o=>h.add(o));const R=[.8,1.4,1.4,1.3,1.2,1,.9,.8,.7,.5],G=[.7,1.5,1.5,1.3,1,.6,.4],x=e.diasLactanciaObjetivo>=305,dt=x?R:G,O=x?1.4:1.5,St=dt.length,B=e.litrosPromedioPorAnimal,lt=e.litrosPicoPorAnimal,yt=lt>B&&B>0?lt/B:O,It=O>1?(yt-1)/(O-1):1,_t=dt.map(o=>(o-1)*It+1);for(let o=0;o<m;o++){const a=l[o-1],mt=Math.floor(o/12)+1,A=o%12+1,Ht=`A침o ${mt} - Mes ${A}`,V=a?a.endCriaH:e.initialCriaH,E=a?a.endCriaM:e.initialCriaM,j=a?a.endLevanteTemprano:e.initialLevanteTemprano,D=a?a.endLevanteMedio:e.initialLevanteMedio,b=a?a.endLevanteTardio:e.initialLevanteTardio,c=a?a.endCabras:e.initialCabras,w=a?a.endPadres:e.initialPadres,kt=V+E+j+D+b+c+w;let K=0;const Mt=[];s=s.filter(n=>n.monthEnd===o?(K+=n.size,Mt.push({id:n.id,size:n.size,monthEnd:o+f}),M.push({id:n.id,deliveries:n.size,startMonth:o}),!1):!0),r.push(...Mt),r=r.filter(n=>n.monthEnd>o);const vt=K*(e.porcentajeProlificidad/100),$=vt*.5,U=vt*.5;let F=0,v=0;if(h.has(A)){const n=s.reduce((rt,ct)=>rt+ct.size,0),_=r.reduce((rt,ct)=>rt+ct.size,0),it=Math.max(0,c-n-_),Wt=Math.max(0,b*(1-d)),st=g.indexOf(A),qt=st!==-1&&e.matingDistribution&&e.matingDistribution[st]!==void 0?e.matingDistribution[st]:1/0,Jt=Math.min(it,qt),Qt=Wt;F=Jt*(e.porcentajePrenez/100),v=Qt*(e.porcentajePrenez/100),F>0&&s.push({id:++L,size:F,monthEnd:o+P}),v>0&&s.push({id:++L,size:v,monthEnd:o+P})}const N=(V+$)*T,W=(E+U)*T,q=j*d,J=D*d,Q=b*d,X=w*z,S=c*z,y=(c-S)*H,ut=S+y,Z=c>0?ut/c:0;s.forEach(n=>n.size*=1-Z),r.forEach(n=>n.size*=1-Z);const Rt=N+W+q+J+Q+S+X,Pt=Math.max(0,E+U-W),I=Pt*(e.eliminacionCabritos/100),Gt=I+y,Y=k,tt=0,Ot=Y+tt,ht=Math.max(0,V+$-N),bt=Math.max(0,j-q),pt=Math.max(0,D-J),Ct=Math.max(0,b-Q),Bt=Math.max(0,Ct-v),et=ht/3,ot=bt/3,nt=pt/6,at=Bt/6,Lt=Math.max(0,ht-et),ft=Math.max(0,Pt-I),Tt=Math.max(0,bt-ot+et),zt=Math.max(0,pt-nt+ot),gt=Math.max(0,Ct-v-at+Y+nt),xt=Math.max(0,c-ut+at+v),At=Math.max(0,w-X+tt),Kt=Lt+ft+Tt+zt+gt+xt+At;let Vt=0,Et=0;M.forEach(n=>n.deliveries*=1-Z),M=M.filter(n=>{const _=o-n.startMonth;if(_<St){const it=_t[_]||0;return Vt+=n.deliveries*e.litrosPromedioPorAnimal*u*it,Et+=n.deliveries,!0}return!1});const jt=Vt,$t=Et,Dt=jt*e.precioLecheLitro,Ut=I*10*e.precioVentaCabritoKg,Ft=y*e.precioVentaDescarteAdulto,Nt=Dt+Ut+Ft;l.push({monthIndex:o,year:mt,month:A,periodLabel:Ht,startCriaH:V,startCriaM:E,startLevanteTemprano:j,startLevanteMedio:D,startLevanteTardio:b,startCabras:c,startPadres:w,startTotal:kt,partos:K,nacimientosH:$,nacimientosM:U,muertesCriaH:N,muertesCriaM:W,muertesLevanteTemprano:q,muertesLevanteMedio:J,muertesLevanteTardio:Q,muertesCabras:S,muertesPadres:X,muertesTotales:Rt,ventasCabritos:I,ventasDescartes:y,ventasTotales:Gt,comprasVientres:Y,comprasPadres:tt,comprasTotales:Ot,promocionCriaH:et,promocionLevanteTemprano:ot,promocionLevanteMedio:nt,promocionLevanteTardio:at,endCriaH:Lt,endCriaM:ft,endLevanteTemprano:Tt,endLevanteMedio:zt,endLevanteTardio:gt,endCabras:xt,endPadres:At,endTotal:Kt,litrosLeche:jt,ingresosTotales:Nt,hembrasProduccion:$t,ingresosLeche:Dt})}return l},C=t=>t.reduce((i,e)=>i+e.ingresosTotales,0),wt=(t,i)=>{const e=[],l=p(t,i),m=C(l),u=(t.porcentajePrenez??85)+10,s={...t,porcentajePrenez:u>100?100:u},r=p(s,i),M=C(r);e.push({kpi:"Pre침ez",impact:M-m,newValue:s.porcentajePrenez,monthlyData:r});const L=(t.porcentajeProlificidad??120)+10,P={...t,porcentajeProlificidad:L},f=p(P,i),T=C(f);e.push({kpi:"Prolificidad",impact:T-m,newValue:P.porcentajeProlificidad,monthlyData:f});const d=Math.max(0,(t.mortalidadCrias??5)-3),z=Math.max(0,(t.mortalidadLevante??3)-2),H=Math.max(0,(t.mortalidadCabras??3)-2),k={...t,mortalidadCrias:d,mortalidadLevante:z,mortalidadCabras:H},h=p(k,i),g=C(h);e.push({kpi:"Mortalidad",impact:g-m,newValue:d,monthlyData:h});const R={baseIncome:m,baseCV:0,baseMonthlyData:l,impacts:e.sort((G,x)=>x.impact-G.impact)};self.postMessage({type:"result",report:R})};self.onmessage=t=>{try{const{baseConfig:i,horizonInYears:e}=t.data;if(!i)throw new Error("No se proporcion칩 configuraci칩n base al worker.");wt(i,e)}catch(i){self.postMessage({type:"error",error:i.message||"Error desconocido en el worker de sensibilidad"})}}})();
